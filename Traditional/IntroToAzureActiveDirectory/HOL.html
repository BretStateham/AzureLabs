<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Markdown Preview</title>
<style>
body{font-family:helvetica, arial, freesans, clean, sans-serif;color:#333;line-height:1.6;font-size:14px}.markdown-body{line-height:1.6;font-size:14px}.markdown-body > *:first-child{margin-top:0 !important}.markdown-body > *:last-child{margin-bottom:0 !important}.markdown-body a.absent{color:#c00}.markdown-body h1{font-weight:700;-webkit-font-smoothing:antialiased;color:#000;font-size:28px;margin:20px 0 10px;padding:0}.markdown-body h2{font-weight:700;-webkit-font-smoothing:antialiased;color:#000;font-size:24px;border-bottom-color:#ccc;border-bottom-width:1px;border-bottom-style:solid;margin:20px 0 10px;padding:0}.markdown-body h3{font-weight:700;-webkit-font-smoothing:antialiased;font-size:18px;margin:20px 0 10px;padding:0}.markdown-body h4{font-weight:700;-webkit-font-smoothing:antialiased;font-size:16px;margin:20px 0 10px;padding:0}.markdown-body h5{font-weight:700;-webkit-font-smoothing:antialiased;font-size:14px;margin:20px 0 10px;padding:0}.markdown-body h6{font-weight:700;-webkit-font-smoothing:antialiased;color:#777;font-size:14px;margin:20px 0 10px;padding:0}.markdown-body blockquote{color:#777;border-left-color:#ddd;border-left-width:4px;border-left-style:solid;margin:15px 0;padding:0 15px}.markdown-body dl{margin:15px 0;padding:0}.markdown-body table{border-collapse:collapse;margin:15px 0;padding:0}.markdown-body pre{border-radius:3px;border:1px solid #ccc;line-height:19px;overflow:auto;font-size:13px;background-color:#f8f8f8;margin:15px 0;padding:6px 10px}.markdown-body li p.first{display:inline-block}.markdown-body dl dt{font-size:14px;font-style:italic;font-weight:700;margin:15px 0 5px;padding:0}.markdown-body dl dt:first-child{padding:0}.markdown-body dl dd{margin:0 0 15px;padding:0 15px}.markdown-body table tr{border-top-color:#ccc;border-top-width:1px;border-top-style:solid;background-color:#fff;margin:0;padding:0}.markdown-body table tr:nth-child(2n){background-color:#f8f8f8}.markdown-body img{max-width:100%}.markdown-body span.frame{overflow:hidden;display:block}.markdown-body span.frame > span{border:1px solid #ddd;width:auto;overflow:hidden;float:left;display:block;margin:13px 0 0;padding:7px}.markdown-body span.frame span img{float:left;display:block}.markdown-body span.frame span span{color:#333;clear:both;display:block;padding:5px 0 0}.markdown-body span.align-center > span{text-align:center;overflow:hidden;display:block;margin:13px auto 0}.markdown-body span.align-center span img{text-align:center;margin:0 auto}.markdown-body span.align-right > span{text-align:right;overflow:hidden;display:block;margin:13px 0 0}.markdown-body span.align-right span img{text-align:right;margin:0}.markdown-body span.float-left{overflow:hidden;margin-right:13px;float:left;display:block}.markdown-body span.float-left span{margin:13px 0 0}.markdown-body span.float-right{overflow:hidden;margin-left:13px;float:right;display:block}.markdown-body span.float-right > span{text-align:right;overflow:hidden;display:block;margin:13px auto 0}.markdown-body pre > code{border:currentColor;white-space:pre;margin:0;padding:0}.markdown-body .highlight pre{border-radius:3px;border:1px solid #ccc;line-height:19px;overflow:auto;font-size:13px;background-color:#f8f8f8;padding:6px 10px}.markdown-body p,.markdown-body li{margin:15px 0}.markdown-body ul,.markdown-body ol{padding-left:30px;margin:15px 0}.markdown-body > h2:first-child,.markdown-body > h1:first-child,.markdown-body > h1:first-child + h2{border:0 currentColor;padding-top:0;margin-top:0}.markdown-body > h3:first-child,.markdown-body > h4:first-child,.markdown-body > h5:first-child,.markdown-body > h6:first-child{padding-top:0;margin-top:0}.markdown-body h1 + p,.markdown-body h2 + p,.markdown-body h3 + p,.markdown-body h4 + p,.markdown-body h5 + p,.markdown-body h6 + p,.markdown-body ul li > :first-child,.markdown-body ol li > :first-child,.markdown-body dl dt > :first-child,.markdown-body dl dd > :first-child,.markdown-body blockquote > :first-child,.markdown-body table tr th > :first-child,.markdown-body table tr td > :first-child{margin-top:0}.markdown-body ul li > :last-child,.markdown-body ol li > :last-child,.markdown-body dl dt > :last-child,.markdown-body dl dd > :last-child,.markdown-body blockquote > :last-child,.markdown-body table tr th > :last-child,.markdown-body table tr td > :last-child{margin-bottom:0}.markdown-body table tr th,.markdown-body table tr td{border:1px solid #ccc;text-align:left;margin:0;padding:6px 13px}.markdown-body span.align-center,.markdown-body span.align-right{overflow:hidden;clear:both;display:block}.markdown-body code,.markdown-body tt{border-radius:3px;border:1px solid #eaeaea;white-space:nowrap;background-color:#f8f8f8;margin:0 2px;padding:0 5px}.markdown-body pre code,.markdown-body pre tt{border:currentColor;background-color:transparent}span.codelanguage{display:none}
</style>
</head>
<body>
<div class="markdown-body">
<p><a name="Title"></a></p>

<h1 id="Introduction_to_Windows_Azure_Active_Directory_-_Visual_Studio_2013">Introduction to Windows Azure Active Directory - Visual Studio 2013</h1>

<hr>

<p><a name="Overview"></a></p>

<h2 id="Overview">Overview</h2>

<p>The goal of this post is to illustrate authentication for applications posted in Windows Azure websites. This particular post will focus on ASP.NET, not node.js or other open-source platforms, including PHP.</p>

<p>You will learn the basic skills of identity management in the cloud. applications can be as powerful as allowing web-based applications that manage a company's active directory. on a more fundamental level active directory can be used to validate users to allow access to secure information.</p>

<p><a name="anchor-name-here"></a></p>

<h4 id="Benefits_of_Active_Directory">Benefits of Active Directory</h4>

<ul>
<li>It makes the task of network administration simpler by maintaining a central repository of information.</li>
<li>It provides a single destination to look out for information.</li>
<li>It provides highly secured access to data through the usage of security policies. 

<ul>
<li>  Thereby it improves the management of security data and workflows.</li>
</ul></li>
<li>Easily scalable. Supports millions of objects in a single domain.</li>
<li>Unified access to resources by supporting a uniform naming convention.</li>
</ul>

<p><a name="anchor-name-here"></a></p>

<h4 id="Key_Facts_about_Single_Sign-On">Key Facts about Single Sign-On</h4>

<ul>
<li><p><strong>In concrete terms</strong> This means that the application will be configured to redirect unauthenticated requests to the IdP, according to some sign-on protocol such as SAML-P, WS-Federation or OpenID Connect. (idP means identity provider)</p></li>
<li><p><strong>Windows Azure Active Directory</strong> makes it easy to <strong>authenticate</strong> and <strong>authorize users</strong>. </p></li>
<li><p>You don't need to spend much time worrying about the vast landscape of <strong>changing security standards</strong>. </p></li>
<li><p><strong>Windows Azure Active Directory</strong> is a cloud-based service that provides an <strong>easy way of authenticating and authorizing users to gain access to your web applications</strong> and services while allowing the features of <strong>authentication and authorization to be factored out of your code</strong>. </p></li>
<li><p>Because it is a service, all that security plumbing code is something you DO NOT NEED to worry about. </p></li>
<li><p><strong>Windows Azure Active Directory</strong> supports integrated <strong>Single Sign On</strong> and centralized authorization into your web applications </p></li>
<li><p>Users hate having to log on mutliple times. If you want to retain your users, you need to allow them to just login once. </p></li>
<li><p><strong>Windows Azure Active Directory</strong> provides out-of-the-box support for <strong>Active Directory Federation Services (AD FS) 2.0</strong> </p></li>
<li><p>Great integration story with on-premise corporate users. 
<strong>Windows Azure Active Directory</strong> relies on <strong>Standards-based identity providers</strong> 
Web identities include <strong>Windows Live ID, Google, Yahoo! and Facebook</strong> </p></li>
</ul>

<p><a name="anchor-name-here"></a></p>

<h4 id="SAML">SAML</h4>

<p>SAML Tokens, WS-Federation, https</p>

<p><img src="images/saml.png?raw=true" alt="saml">
</p>

<p><strong>SAML</strong> is an XML-based open standard data format for exchanging authentication and authorization data between parties, in particular, between an identity provider and a service provider. </p>

<ul>
<li><strong>SAML</strong> is a product of the OASIS Security Services Technical Committee</li>
</ul>

<h4 id="SOAP">SOAP</h4>

<p>SOAP on the decline relative to REST-based technologies</p>

<p><img src="images/soap.png?raw=true" alt="soap">
</p>

<p>SOAP is for exchanging structured information in the implementation of Web Services in computer networks. </p>

<p>It relies on XML Information Set for its message format, and usually relies on other Application Layer protocols, most notably Hypertext Transfer Protocol (HTTP) or Simple Mail Transfer Protocol (SMTP), for message negotiation and transmission.</p>

<h4 id="What_is_WS-Federation">What is WS-Federation?</h4>

<p>WS-Federation is a WS-* specification and OASIS standard </p>

<ul>
<li><p>Tries to tackle the security challenges in <strong>web applications</strong> and <strong>web services</strong> in a <strong>variety of trust relationships</strong>. </p></li>
<li><p>WS-Federation supports SOAP clients and web services. 
REST is not supported. </p></li>
<li><p><strong>WS-Federation</strong> provides a common model for performing <strong>Federated Identity</strong> operations for both <strong>web services</strong> and <strong>browser-based applications</strong>. </p></li>
<li><p><strong>WS-Federation</strong> builds upon the <strong>Security Token Service</strong> model </p></li>
<li><p><strong>WS-Security, WS-Trust</strong>, and <strong>WS-SecurityPolicy</strong> provide a basic model for federation between <strong>Identity Providers</strong> and <strong>Relying Parties</strong> </p></li>
<li><p><strong>WS-Federation</strong> are <strong>claims-based</strong>. </p></li>
<li><p><strong>Claims</strong> are just <strong>dictionaries</strong> inside of a <strong>SAML token</strong> where key value pairs represent the <strong>attributes of a user</strong> </p></li>
<li><p>Developers can iterate through dictionary to see attributes of a user’s identity to determine what kind of claims we want to authorize </p></li>
<li><p>These <strong>claims</strong> are also called <strong>assertions</strong>. 
<strong>WS-Federation</strong> strives for richer trust relationships </p></li>
<li><p>It wants to join together <strong>HTTP</strong> with <strong>STS</strong> and <strong>WS-Trust</strong> to allow resources in <strong>one</strong> <strong>realm</strong> get identities (and related attributes) that are managed and maintained in <strong>another</strong> <strong>realm</strong>. </p></li>
<li><p>You can imagine scenarios where <strong>WS-Federation</strong> is needed, such as protecting patient records from unauthorized users when these patient records are traveling among multiple health providers. </p></li>
<li><p>Federation makes sense in a supply chain scenario where a factory needs just-in-time inventory levels from distributors or retailers (and in reverse). </p></li>
</ul>

<p><a name="anchor-name-here"></a></p>

<h4 id="What_is_single_sign-on">What is single sign-on?</h4>

<p><strong>Single sign-on</strong> (<strong>SSO</strong>) is a property of access control of multiple related, but independent software systems. </p>

<ul>
<li>With <strong>single sign-on</strong> a user logs in once and gains access to all systems without being prompted to log in again at each of them. </li>
</ul>

<p><img src="Images/windows-azure-ad-architecture-overview.png?raw=true" alt="Windows Azure AD Architecture Overview">
</p>

<p><strong>Prerequisites</strong></p>

<ul>
<li><p>Visual Studio 2013 </p></li>
<li><p>An account on Windows Azure. You can get a free account here <a href="https://manage.windowsazure.com/">https://manage.windowsazure.com/</a>.</p></li>
</ul>

<p><a name="anchor-name-here"></a></p>

<h2 id="Exercise_1">Exercise 1</h2>

<p>In this section you will log into the portal and choose to create a new active directory service. In the left menu pane choose <strong>Active Directory</strong>.</p>

<p><a name="anchor-name-here"></a></p>

<h3 id="Task_1_Entering_basic_directory_information">Task 1: Entering basic directory information</h3>

<p>In the next few screens you'll enter information about the newly created directory. You will need to provide a login name and domain name to be used.</p>

<ol>
<li><p>You will add a new active directory. Select active directory from the left menu and click new.  <strong>WARNING - You can't currently delete an Azure Active Directory.  Make sure to use a name you are comfortable keeping in your subscription.</strong> </p>

<p><img src="images/ex1_task1_a.png?raw=true" alt="ex1_task1_a.png">
</p>

<p><em>Creating a new active directory</em></p></li>
<li><p>Enter in the name, the domain name, and choose the country or region.</p>

<p><img src="images/ex1_task1_b.png?raw=true" alt="ex1_task1_b.png">
</p>

<p><em>Adding a new directory</em></p></li>
<li><p>Changing details about the directory (brunodirectory). Click the arrow to drill into a specific directory.</p>

<p><img src="images/ex1_task1_c.png?raw=true" alt="ex1_task1_c.png">
</p>

<p><em>Changing directory details</em></p></li>
<li><p>You will add users. Click the user menu.</p>

<p><img src="images/ex1_task1_d.png?raw=true" alt="ex1_task1_d.png">
</p>

<p><em>Adding users</em></p></li>
<li><p>From the left menu bar choose add user.</p>

<p><img src="images/ex1_task1_d2.png?raw=true" alt="ex1_task1_d2.png">
</p>

<p><em>Adding a user</em></p></li>
<li><p>You will enter a username for the provider directory.</p>

<p><img src="images/ex1_task1_e.png?raw=true" alt="ex1_task1_e.png">
</p>

<p><em>Adding a user</em></p></li>
<li><p>You will enter user profile details. Enter first, last, display name. Also select the role for the user. Choose global administrator. Also indicate an email address.</p>

<p><img src="images/ex1_task1_f.png?raw=true" alt="ex1_task1_f.png">
</p>

<p><em>Entering user profile details</em></p></li>
<li><p>Creating a temporary password. Click the create button</p>

<p><img src="images/ex1_task1_g.png?raw=true" alt="ex1_task1_g.png">
</p>

<p><em>Creating a temporary password</em></p></li>
<li><p>You will be given a new password. You will need to select an email address to send a confirming email to.</p>

<p><img src="images/ex1_task1_h.png?raw=true" alt="ex1_task1_h.png">
</p>

<p><em>Confirming your temporary password</em></p></li>
<li><p>Validating that the user was added. For the details section of your directory, notice the display name should match the one entered, in addition to the user name and domain.</p>

<p><img src="images/ex1_task1_i.png?raw=true" alt="ex1_task1_i.png">
</p>

<p><em>Validating user profile details</em></p></li>
</ol>

<p><a name="anchor-name-here"></a></p>

<h2 id="Exercise_2">Exercise 2</h2>

<p>Exercise two is about creating an MVC application that can leverage Azure active directory, or directory services. you will learn the built-in tooling inside of Visual Studio is that makes this possible.</p>

<p><a name="anchor-name-here"></a></p>

<h3 id="Task_1_Creating_the_web_application">Task 1: Creating the web application</h3>

<p>In this task you will create the ASP.net web application.</p>

<ol>
<li><p>Start Visual Studio 2013 as administrator. From the start page click new project.</p>

<p><img src="images/ex2_task1_a.png?raw=true" alt="ex2_task1_a.png">
</p>

<p><em>Creating a new MVC project</em></p></li>
<li><p>From the templates choose Visual C#. from the middle pane select ASP.NET Web Application. Then provide a name, location and click ok.</p>

<p><img src="images/ex2_task1_b.png?raw=true" alt="ex2_task1_b.png">
</p>

<p><em>Creating a new ASP.net web application</em></p></li>
<li><p>From the template pane select MVC. Then click change authentication.</p>

<p><img src="images/ex2_task1_c.png?raw=true" alt="ex2_task1_c.png">
</p>

<p><em>Specifying an MVC project with authentication</em></p></li>
<li><p>Login with the credentials from the previous exercise. These are the credentials that you specified at the Azure portal.</p>

<p><img src="images/ex2_task1_d.png?raw=true" alt="ex2_task1_d.png">
</p>

<p><em>Logging in to your domain</em></p></li>
<li><p>You will need to create a new password. You will need your old one to do so from the previous exercise.</p>

<p><img src="images/ex2_task1_e.png?raw=true" alt="ex2_task1_e.png">
</p>

<p><em>Creating a new password</em></p></li>
<li><p>There are some important selections here. First choose organizational accounts from the options on the left. On the right pane indicate cloud - single organization, a domain of brunodirectory.onmicrosoft.com and an access level of single sign-on, read and write directory privileges. This will enable the logged in user (azureuser) to modify directory entries, not just read them.</p>

<p><img src="images/ex2_task1_f.png?raw=true" alt="ex2_task1_f.png">
</p>

<p><em>Changing authentication for the MVC application</em></p></li>
</ol>

<p><a name="anchor-name-here"></a></p>

<h3 id="Task_2_Testing_the_entire_process">Task 2: Testing the entire process</h3>

<p>This task is about testing the authentication mechanism to make sure it works. we may do a follow-up lab after this one to see exactly how the user can modify the directory graph. As you recall, the user we created had read/write privileges.</p>

<ol>
<li><p>You will not test the login process. From the debug menu of Visual Studio click on Internet Explorer.</p>

<p><img src="images/ex2_task1_g.png?raw=true" alt="ex2_task1_g.png">
</p>

<p><em>Testing your MVC authentication mechanism.</em></p></li>
<li><p>As you might expect you are asked to provide some security credentials to continue.</p>

<p><img src="images/ex2_task1_h.png?raw=true" alt="ex2_task1_h.png">
</p>

<p><em>Continuing to the website to enter security credentials</em></p></li>
<li><p>Notice that the user is logged in. Your MVC application has been authenticated using active directory. The currently logged in user can even modify the directory graph for this domain ( <a href="mailto:brunodirectory@onmicrosoft.com">brunodirectory@onmicrosoft.com</a> ).</p>

<p><img src="images/ex2_task1_i.png?raw=true" alt="ex2_task1_i.png">
</p>

<p><em>Validating login</em></p></li>
</ol>

<p><a name="anchor-name-here"></a></p>

<h2 id="Summary">Summary</h2>

<p>In this post we learned how to leverage directory services in Azure. we created an MVC web application that was able to login a user created at the Azure portal. In the next post we may discover that we can actually modify directory information assuming users were added having global administrative privileges.</p>

</div>
</body>
</html>
